<!DOCTYPE html>
<html lang="en">
  <head>
    <title></title>
    <link rel="stylesheet" href="../../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../../assets/css/typeahead.js-bootstrap.css">
    <link rel="stylesheet" href="../../assets/css/font-awesome.css">
    <link rel="stylesheet" href="../../assets/css/prism.css">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="../assets/css/font-awesome-ie7.css">
    <![endif]-->
    <script type="text/javascript" src="../../assets/js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="../../assets/js/bootstrap.js"></script>
    <script type="text/javascript" src="../../assets/js/typeahead.js"></script>
    <script type="text/javascript" src="../../assets/js/main.js"></script>
    
    <script>
      window.moduleLevel = "../..";
    </script>
  </head>
  <body>
    <div class="row-fluid">
      <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <a class="brand" href="../../index.html"> API</a>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li><a href="#dependencies">Dependencies</a></li>
                <li><a href="#variables">Variables</a></li>
                <li><a href="#functions">Functions</a></li>
                <li><a href="#classes">Classes</a></li>
              </ul>
            </div>
            <input class="typeahead" placeholder="Search..." type="text" >
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span12">
          <div class="page-header">
            <h1>rendermanager</h1>
          </div>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3">
          <div class="left-section">
            <ul class="nav nav-list">
              <li class="nav-header">
                <a href="#" id="toggle-other-modules"><i class="icon-folder-close"></i> Modules (17)</a>
              </li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_"><i class="icon-folder-open"></i></a>
              </li>
            </ul>
            <ul id="package_" class="nav nav-list">
              <li><a href="../../modules/Gruntfile.html">Gruntfile</a></li>
              <li><a href="../../modules/main.html">main</a></li>
            </ul>
                        <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_lib"><i class="icon-folder-open"></i>lib</a>
              </li>
            </ul>
            <ul id="package_lib" class="nav nav-list">
              <li><a href="../../modules/lib/assetmanager.html">assetmanager</a></li>
              <li><a href="../../modules/lib/asyncqueue.html">asyncqueue</a></li>
              <li><a href="../../modules/lib/componentmanager.html">componentmanager</a></li>
              <li><a href="../../modules/lib/errormanager.html">errormanager</a></li>
              <li><a href="../../modules/lib/filemanager.html">filemanager</a></li>
              <li><a href="../../modules/lib/headlights.html">headlights</a></li>
              <li><a href="../../modules/lib/parsermanager.html">parsermanager</a></li>
              <li><a href="../../modules/lib/renderer.html">renderer</a></li>
              <li><a href="../../modules/lib/rendermanager.html">rendermanager</a></li>
              <li><a href="../../modules/lib/statemanager.html">statemanager</a></li>
            </ul>
                        <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_lib_dom"><i class="icon-folder-open"></i>lib.dom</a>
              </li>
            </ul>
            <ul id="package_lib_dom" class="nav nav-list">
              <li><a href="../../modules/lib/dom/bounds.html">bounds</a></li>
              <li><a href="../../modules/lib/dom/layer.html">layer</a></li>
              <li><a href="../../modules/lib/dom/layereffects.html">layereffects</a></li>
              <li><a href="../../modules/lib/dom/mask.html">mask</a></li>
              <li><a href="../../modules/lib/dom/path.html">path</a></li>
            </ul>
            
          </div>
        </div>
        <div class="module span9">
          <section class="description">
            <h3>Description</h3>
            <div>
              
            </div>
          </section>
    
          <section class="dependencies">
            <h3>Dependencies</h3>
            
            <ul class="nav nav-list">
              <li><a href="..&#x2F;../modules/events.html">events</a></li>
              <li><a href="..&#x2F;../modules/os.html">os</a></li>
              <li><a href="..&#x2F;../modules/q.html">q</a></li>
              <li><a href="..&#x2F;../modules/./renderer.html">renderer</a></li>
              <li><a href="..&#x2F;../modules/util.html">util</a></li>
            </ul>
            
            
          </section>
    
    
          
          <section class="classes">
            <h2>Classes</h2>
            
              <div class="well">
                <div class="member public">
                  <span class="pull-right scope">
                    Constructor
                  </span>
                  <h4>RenderManager</h4>
                  <em><p>Manages asynchonous rendering jobs across all active documents.</p>
</em>
                  <dl>
                    <dt>generator</dt>
                    <dd class="label label-info pull-left">Generator</dd>
                    <dd></dd>
                    <dt>config</dt>
                    <dd class="label label-info pull-left">object</dd>
                    <dd></dd>
                    <dt>logger</dt>
                    <dd class="label label-info pull-left">Logger</dd>
                    <dd></dd>
                  </dl>
                  
                  <button class="btn btn-small show-code">Show code</button>
                  <pre class="language-javascript"><code class="language-javascript">    function RenderManager(generator, config, logger) {
        events.EventEmitter.call(this);

        this._generator = generator;
        this._config = config;
        this._logger = logger;

        this._svgRenderers = {};
        this._pixmapRenderers = {};

        this._componentsByDocument = {};
        this._pending = {};
        this._working = {};

        this._renderedAssetCount = 0;
    }

    util.inherits(RenderManager, events.EventEmitter);</code></pre>
                </div>
      
                <section class="properties ">
                  <h3>Properties 
                    <label class="checkbox">
                      <input class="toggle-public" type="checkbox"> Show Private Members
                    </label>
                  </h3>
                  
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_changeTimer</h4>
                    <dl>
                      <dt>Private</dt>
                    </dl>
                    <div class="description"><p>@type {?number}</p>
</div>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._changeTimer = null;</code></pre>
                  </div>
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_config</h4>
                    <dl>
                      <dt>Private</dt>
                    </dl>
                    <div class="description"><p>@type {object}</p>
</div>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._config = null;</code></pre>
                  </div>
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_generator</h4>
                    <dl>
                      <dt>Private</dt>
                    </dl>
                    <div class="description"><p>@type {Generator}</p>
</div>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._generator = null;</code></pre>
                  </div>
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_logger</h4>
                    <dl>
                      <dt>Private</dt>
                    </dl>
                    <div class="description"><p>@type {Logger}</p>
</div>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._logger = null;</code></pre>
                  </div>
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_pixmapRenderers</h4>
                    <dl>
                      <dt>Type</dt>
                      <dd>{number: PixmapRenderer}</dd>
                      <dt>Private</dt>
                    </dl>
                    <div class="description"><p>Per-document set of PixmapRenderer objects</p>
</div>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._pixmapRenderers = null;</code></pre>
                  </div>
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_renderedAssetCount</h4>
                    <dl>
                      <dt>Private</dt>
                    </dl>
                    <div class="description"><p>@type {number} The total number of assets rendered.</p>
</div>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._renderedAssetCount = null;</code></pre>
                  </div>
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_svgRenderers</h4>
                    <dl>
                      <dt>Type</dt>
                      <dd>{number: SVGRenderer}</dd>
                      <dt>Private</dt>
                    </dl>
                    <div class="description"><p>Per-document set of SVGRenderer objects</p>
</div>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._svgRenderers = null;</code></pre>
                  </div>
                  
                </section>
      
                <section class="methods">
                  <h3>Methods 
                    <label class="checkbox">
                      <input class="toggle-public" type="checkbox"> Show Private Members
                    </label>
                  </h3>
                  
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_getPixmapRenderer</h4>
                    <div class="description"><p>Return, creating if necessary, a Pixmap renderer for the given document.</p>
</div>
                    <dl>
                      <dt>document</dt>
                      <dd class="label label-info pull-left">Document</dd>
                      <dd></dd>
                    </dl>
                    <dl>
                      <dt>Returns: </dt>
                      <dd class="label label-info pull-left">PixmapRenderer</dd>
                      <dd></dd>
                    </dl>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._getPixmapRenderer = function (document) {
        if (!this._pixmapRenderers.hasOwnProperty(document.id)) {
            this._pixmapRenderers[document.id] =
                createPixmapRenderer(this._generator, this._config, this._logger, document);
        }

        return this._pixmapRenderers[document.id];
    };</code></pre>
                  </div>
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_getSVGRenderer</h4>
                    <div class="description"><p>Return, creating if necessary, an SVG renderer for the given document.</p>
</div>
                    <dl>
                      <dt>document</dt>
                      <dd class="label label-info pull-left">Document</dd>
                      <dd></dd>
                    </dl>
                    <dl>
                      <dt>Returns: </dt>
                      <dd class="label label-info pull-left">SVGRenderer</dd>
                      <dd></dd>
                    </dl>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._getSVGRenderer = function (document) {
        if (!this._svgRenderers.hasOwnProperty(document.id)) {
            this._svgRenderers[document.id] =
                createSVGRenderer(this._generator, this._config, this._logger, document);
        }

        return this._svgRenderers[document.id];
    };</code></pre>
                  </div>
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_processNextPending</h4>
                    <div class="description"><p>If the work set is non-empty, begin processing it by removing one layer
id, rendering its components, and then recursively processing the rest
of the work set.</p>
</div>
                    <dl>
                    </dl>
                    <dl>
                    </dl>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._processNextPending = function () {
        var working = Object.keys(this._working);
        if (working.length &gt;= MAX_JOBS) {
            return;
        }

        var keys = Object.keys(this._pending);
        if (keys.length &gt; 0) {
            if (working.length === 0) {
                this.emit(&quot;active&quot;);
            }

            &#x2F;&#x2F; Pick a component to process from the pending set
            var componentId = keys[0],
                job = this._pending[componentId];

            delete this._pending[componentId];
            this._working[componentId] = job;

            var deferred = job.deferred,
                component = job.component,
                layer = component.layer,
                document = layer.document;

            this._logger.info(&quot;Rendering: %s (%d;%d)&quot;, component.assetPath, keys.length - 1, working.length + 1);
            this._renderComponent(document, layer, component)
                .then(function (path) {
                    deferred.resolve(path);
                }, function (err) {
                    deferred.reject(err);
                })
                .finally(function () {
                    delete this._working[componentId];

                    if (Object.keys(this._working).length === 0) {
                        this.emit(&quot;idle&quot;);
                    }

                    if (this._componentsByDocument.hasOwnProperty(document.id)) {
                        delete this._componentsByDocument[document.id][componentId];

                        if (Object.keys(this._componentsByDocument[document.id]).length === 0) {
                            delete this._componentsByDocument[document.id];
                        }
                    }

                    this._processNextPending();
                }.bind(this))
                .done();

            this._processNextPending();
        } else {
            this._changeTimer = null;
        }
    };</code></pre>
                  </div>
                  <div class="member private">
                    <span class="pull-right scope">
                      Private
                      
                    </span>
                    <h4>_renderComponent</h4>
                    <div class="description"><p>Render one component for a layer.</p>
</div>
                    <dl>
                      <dt>document</dt>
                      <dd class="label label-info pull-left">Document</dd>
                      <dd></dd>
                      <dt>layer</dt>
                      <dd class="label label-info pull-left">Layer</dd>
                      <dd></dd>
                      <dt>component</dt>
                      <dd class="label label-info pull-left">Component</dd>
                      <dd></dd>
                    </dl>
                    <dl>
                      <dt>Returns: </dt>
                      <dd class="label label-info pull-left">Promise.&lt;string&gt;</dd>
                      <dd>Resolves with the temporary path of the new asset once rendering is complete.</dd>
                    </dl>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype._renderComponent = function (document, layer, component) {
        var renderer;

        process.nextTick(function () {
            this.emit(&quot;render&quot;, ++this._renderedAssetCount);
        }.bind(this));

        if (component.extension === &quot;svg&quot;) {
            renderer = this._getSVGRenderer(document);
        } else {
            renderer = this._getPixmapRenderer(document);
        }

        return renderer.render(layer, component);
    };</code></pre>
                  </div>
                  <div class="member">
                    <span class="pull-right scope">
                      
                      
                    </span>
                    <h4>cancel</h4>
                    <div class="description"><p>Cancel a pending render job for the given component. If the promise
returned from RenderManager.render is still pending, canceling the job
causes the promise to be rejected without an error message.</p>
</div>
                    <dl>
                      <dt>componentId</dt>
                      <dd class="label label-info pull-left">number</dd>
                      <dd></dd>
                    </dl>
                    <dl>
                    </dl>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype.cancel = function (componentId) {
        var job,
            set;

        if (this._pending.hasOwnProperty(componentId)) {
            set = this._pending;
        } else if (this._working.hasOwnProperty(componentId)) {
            set = this._working;
        } else {
            return;
        }

        job = set[componentId];
        delete set[componentId];

        var deferred = job.deferred,
            component = job.component,
            layer = component.layer,
            document = layer.document,
            documentComponents = this._componentsByDocument[document.id];

        delete documentComponents[componentId];
        if (Object.keys(documentComponents).length === 0) {
            delete this._componentsByDocument[document.id];
        }

        &#x2F;&#x2F; TODO: Update renderers to test for cancellation at async entry points
        deferred.reject();
    };</code></pre>
                  </div>
                  <div class="member">
                    <span class="pull-right scope">
                      
                      
                    </span>
                    <h4>cancelAll</h4>
                    <div class="description"><p>Cancel all of a given document&#39;s render jobs.</p>
</div>
                    <dl>
                    </dl>
                    <dl>
                    </dl>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype.cancelAll = function (documentId) {
        if (this._componentsByDocument.hasOwnProperty(documentId)) {
            Object.keys(this._componentsByDocument[documentId]).forEach(function (componentId) {
                this.cancel(componentId);
            }, this);
        }
    };

    module.exports = RenderManager;
}());</code></pre>
                  </div>
                  <div class="member">
                    <span class="pull-right scope">
                      
                      
                    </span>
                    <h4>render</h4>
                    <div class="description"><p>Render the given component to an asset at a temporary location in the filesystem.</p>
</div>
                    <dl>
                      <dt>component</dt>
                      <dd class="label label-info pull-left">Component</dd>
                      <dd></dd>
                    </dl>
                    <dl>
                      <dt>Returns: </dt>
                      <dd class="label label-info pull-left">Promise.&lt;string&gt;</dd>
                      <dd>Resolves with the temporary path of the new asset once rendering is complete.</dd>
                    </dl>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="language-javascript"><code class="language-javascript">    RenderManager.prototype.render = function (component) {
        if (this._pending.hasOwnProperty(component.id)) {
            throw new Error(&quot;Render already pending for component: &quot; + component.id);
        }

        var deferred = Q.defer(),
            layer = component.layer,
            document = layer.document;

        this._pending[component.id] = {
            deferred: deferred,
            component: component
        };

        if (!this._componentsByDocument.hasOwnProperty(document.id)) {
            this._componentsByDocument[document.id] = {};
        }
        this._componentsByDocument[document.id][component.id] = true;

        if (!this._changeTimer) {
            this._changeTimer = setTimeout(function () {
                this._processNextPending();
            }.bind(this), CHANGE_DELAY);
        }

        return deferred.promise;
    };</code></pre>
                  </div>
                </section>
                
              </div>
            
          </section>
          
        </div>
      </div>
    </div>

    <script type="text/javascript" src="../../assets/js/prism.js"></script>
  </body>
</html>